<div class="container" *ngIf="commande$ | async as commande; else loading">
  <div class="header">
    <h2>Détail Commande {{ commande.numeroCommande }}</h2>
    <div class="actions">
      <button (click)="goBack()" class="btn-back">Retour</button>
      <a [routerLink]="['/commandes', commande.id, 'edit']" class="btn-edit">Modifier</a>
    </div>
  </div>

  <div class="card">
    <h3>Informations Générales</h3>
    <div class="info-grid">
      <div class="info-item">
        <span class="label">Date:</span>
        <span class="value">{{ commande.dateCommande | date:'medium' }}</span>
      </div>
      <div class="info-item">
        <span class="label">Statut:</span>
        <span class="value status-badge" [ngClass]="commande.statut.toLowerCase()">{{ commande.statut }}</span>
      </div>
      <div class="info-item">
        <span class="label">Montant Total:</span>
        <span class="value price">{{ commande.montantTotal | currency:'EUR' }}</span>
      </div>
    </div>
  </div>

  <div class="card client-card">
    <h3>Client</h3>
    <div class="info-grid" *ngIf="commande.client; else noClient">
      <div class="info-item">
        <span class="label">Nom:</span>
        <span class="value">{{ commande.client.nom }} {{ commande.client.prenom }}</span>
      </div>
      <div class="info-item">
        <span class="label">Email:</span>
        <span class="value">{{ commande.client.email }}</span>
      </div>
      <div class="info-item">
        <span class="label">Téléphone:</span>
        <span class="value">{{ commande.client.telephone }}</span>
      </div>
      <div class="info-item full-width">
        <span class="label">Adresse:</span>
        <span class="value">{{ commande.client.adresse }}</span>
      </div>
      <div class="client-actions">
        <a [routerLink]="['/clients', commande.clientId]" class="link-client">Voir fiche client</a>
      </div>
    </div>
    <ng-template #noClient>
      <p class="text-muted">Information client non disponible.</p>
    </ng-template>
  </div>

  <div class="card lines-card">
    <h3>Lignes de Commande</h3>
    <table class="lines-table">
      <thead>
        <tr>
          <th>Produit</th>
          <th>Quantité</th>
          <th>Prix Unitaire</th>
          <th>Total Ligne</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let ligne of commande.lignesCommande">
          <td>{{ ligne.produit?.libelle || 'Produit #' + ligne.produitId }}</td>
          <td>{{ ligne.quantite }}</td>
          <td>{{ ligne.produit?.prixUnitaire | currency:'EUR' }}</td>
          <td>{{ (ligne.quantite * (ligne.produit?.prixUnitaire || 0)) | currency:'EUR' }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<ng-template #loading>
  <div class="loading">Chargement du détail de la commande...</div>
</ng-template>
